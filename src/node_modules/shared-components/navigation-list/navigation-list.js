import React from "react";

import "./navigation-list.css";
import NavigationListItem from "../navigation-list-item";

import Timeline from "@material-ui/icons/CalendarToday";
import IconButton from "@material-ui/core/es/IconButton/IconButton";
import Badge from "@material-ui/core/es/Badge/Badge";
import { getEventsNumber } from "api";
import { Link } from "react-router-dom";
import Spinner from "shared-components/spinner";

export default class Header extends React.Component {
  state = {
    loading: true
  };

  componentWillMount() {
    if (localStorage.getItem("feathers-jwt"))
      getEventsNumber().then(response =>
        this.setState({ badge: response, loading: false })
      );
  }
  render() {
    const navItemsGuest = [
      { label: "Sign in", link: "/login" },
      { label: "Sign up", link: "/registration" }
    ];

    const navItemsSignedIn = [{ label: "Account", link: "/account" }];

    const navItems = localStorage.getItem("feathers-jwt")
      ? navItemsSignedIn
      : navItemsGuest;
    if (this.state.loading && localStorage.getItem("feathers-jwt")) {
      return <Spinner />;
    }
    return (
      <div className="navigation-list">
        {localStorage.getItem("feathers-jwt") && (
          <Link to="/scheduler">
            <IconButton>
              <Badge badgeContent={this.state.badge} color="primary">
                <Timeline />
              </Badge>
            </IconButton>
          </Link>
        )}
        <ul>
          {navItems.map(item => {
            return <NavigationListItem item={item} key={item.label} />;
          })}
        </ul>
      </div>
    );
  }
}
