import client from "feathers/client";
import { authStore } from "store";

export const getLoggedInUser = () =>
  client
    .authenticate()
    .then(response => {
      return client.passport.verifyJWT(response.accessToken);
    })
    .then(payload => {
      return client.service("customers").get(payload.userId);
    })
    .catch(() => undefined);

export const updateUser = user => {
  client.service("customers").patch(authStore.user.id, user);
  authStore.setUser(user);
};

export const signInCustomer = (email, password) =>
  client
    .authenticate({
      strategy: "local",
      email,
      password
    })
    .then(response => client.passport.verifyJWT(response.accessToken))
    .then(payload => client.service("customers").get(payload.userId));

export const signUpCustomer = user => client.service("customers").create(user);
