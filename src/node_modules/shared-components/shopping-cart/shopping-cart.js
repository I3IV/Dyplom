import IconButton from "@material-ui/core/es/IconButton/IconButton";
import React, { Component, Fragment } from "react";
import Collapse from "@material-ui/core/Collapse";
import DishesList from "components/pages/schedule-items-page/schedule-item-dishes-list";
import Button from "@material-ui/core/Button";
import ShoppingCartImage from "@material-ui/icons/ShoppingCart";
import Badge from "@material-ui/core/es/Badge/Badge";
import "./shopping-cart.css";
import { dishDown, dishUp, dishDelete } from "api";
import {cartStore} from "store";
import {observer} from "mobx-react";

class SelectControl extends Component {
  state = {
    expanded: false
  };

  handleCartClick = () => {
    this.setState({ expanded: !this.state.expanded });
  };

  render() {
    const cart = cartStore.cart
      ? cartStore.cart
      : undefined;
    return (
      <Fragment>
        <IconButton onClick={this.handleCartClick}>
          <Badge badgeContent={cart ? cart.dishes.length : 0} color="primary">
            <ShoppingCartImage />
          </Badge>
        </IconButton>
        <div className="front">
          <Collapse in={this.state.expanded && cart && cart.dishes.length !== 0} timeout="auto" unmountOnExit>
            <div className="front-dishes-list">
              <DishesList
                items={cart ? cart.dishes : []}
                onDishUp={dishUp}
                onDishDown={dishDown}
                onDishDelete={dishDelete}
              />
              <Button
                onClick={this.props.handleApply}
                fullWidth
                color="primary"
                variant="contained"
              >
                Proceed To Checkout
              </Button>
            </div>
          </Collapse>
        </div>
      </Fragment>
    );
  }
}

export default observer(SelectControl);